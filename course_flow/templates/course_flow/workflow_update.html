{% extends "course_flow/base.html" %}
<!-- -->
{% load static compress i18n %} {% get_current_language as LANGUAGE_CODE %}
<!-- -->
{% load static i18n %}
<!-- -->
{% block title %}{% endblock %}
<!-- -->
{% block metadescription %} {% endblock %}
<!-- -->
{% block header %}{% endblock %}
<!-- -->
{% block body %}

<div id="container" class="body-wrapper"></div>
<div id="popup-container"></div>
<div id="sidebar" class="side-bar">
  <ul>
    <li>
      <a href="#edit-menu"
        ><img
          src="{% static 'course_flow/img/images_svg/edit_pencil_blue.svg' %}"
      /></a>
    </li>
    <li>
      <a href="#node-bar"
        ><img src="{% static 'course_flow/img/images_svg/add_new_blue.svg' %}"
      /></a>
    </li>
    {% if is_strategy == "false" %}
    <li>
      <a href="#outcome-bar"
        ><img src="{% static 'course_flow/img/images_svg/outcomes_blue.svg' %}"
      /></a>
    </li>
    <li>
      <a href="#strategy-bar"
        ><img src="{% static 'course_flow/img/images_svg/strategy_blue.svg' %}"
      /></a>
    </li>
    {% endif %}
  </ul>
    <div id="edit-menu" class="right-panel-container"></div>
    <div id="node-bar" class="right-panel-container"></div>
    {% if is_strategy == "false" %}
        <div id="outcome-bar" class="right-panel-container"></div>
        <div id="strategy-bar" class="right-panel-container"></div>
    {% endif %}
  <div class="window-close-button" id="side-bar-close-button">
    <img src="{% static 'course_flow/img/images_svg/close.svg' %}" />
  </div>
</div>

{{is_strategy}} {% endblock %}
<!-- -->
{% block foot %} {% endblock %}
<!-- -->
{% csrf_token %}
<!-- -->
{% block read_only_scripts %}

<script nonce="{{request.csp_nonce}}">
  const read_only = false;
</script>

{% endblock %}
<!-- -->
{% block scripts %} {{ block.super }}
<script nonce="{{request.csp_nonce}}">
  const workflow_paths = {
      activity:'{% url "course_flow:activity-detail-view" pk=object.pk %}',
      course:'{% url "course_flow:course-detail-view" pk=object.pk %}',
      program:'{% url "course_flow:program-detail-view" pk=object.pk %}',
  }
  const iconpath = "{% static 'course_flow/img/images_svg/' %}";

  $("#sidebar").tabs({
      active:1,
      disabled:[0],
      collapsible:true,
      activate:(evt,ui)=>{
          if(ui.oldTab.length==0)$("#sidebar").removeClass("collapsed");
          else if(ui.newTab.length==0)$("#sidebar").addClass("collapsed");
      }
  });

  $("#sidebar").on("mouseup dblclick mousedown",(evt)=>{evt.stopPropagation();});

  if(read_only)$("#sidebar").hide();
  else{
      $("#side-bar-close-button").on("click",()=>{
          $("#sidebar").addClass("collapsed");
          $("#sidebar").tabs("option","active",false);
      });
  }

  {% if parent_project_pk %}
      if(read_only){
          $("#floatbar").append("<a id='project-return' href={% url 'course_flow:project-detail-view' pk=parent_project_pk %} class='floatbardiv'><img src='"+iconpath+"goback.svg'/><div>Project</div></div>");
      }else{
          $("#floatbar").append("<a id='project-return' href={% url 'course_flow:project-update' pk=parent_project_pk %} class='floatbardiv'><img src='"+iconpath+"goback.svg'/><div>Project</div></div>");
      }
  {% endif %}

  workflow_data_package = {{data_package|safe}}
  var workflow_renderer;

  {% if is_strategy == "false" %}
      $("#viewbar").append("<div id='outcomeviewbar'><div class='outcomeviewtext'>Outcome View:</div><label class='switch'><input type='checkbox'><span class ='slider round'></span></label></div>");

      $("#outcomeviewbar input").on("change",(evt)=>{
          workflow_renderer.render($("#container"),evt.target.checked)
      });
  {% endif %}

  const user_id = {{ user.id }};
  const create_path=null;

  window.addEventListener("load", function(){
      workflow_renderer = new renderers.WorkflowRenderer(workflow_data_package);
      $(document).ajaxError(renderers.fail_function);
      workflow_renderer.render($("#container"));
  });
</script>

{% endblock %}
