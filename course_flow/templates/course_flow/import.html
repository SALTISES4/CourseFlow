{% extends "course_flow/base.html" %}
<!-- -->
{% load static i18n %}
<!-- -->
{% block header %} {% endblock %}
<!-- -->
{% block title %}{% endblock %}
<!-- -->
{% block metadescription %} {% endblock %}
<!-- -->
{% block body %}
<div id="content-container" class="body-wrapper">
  <div class="splash-page">
    <div class="splash-wrapper">
      <button class="splash-image-wrapper">
        <img
          id="import-json"
          src="{% static 'course_flow/img/images_svg/open_basic.svg' %}"
        />
        <div>Import Project<br /><small>(May take some time)</small></div>
      </button>
    </div>
  </div>
</div>
<!-- -->
{% endblock %}
<!-- -->
{% block foot %} {% endblock %}
<!-- -->
{% csrf_token %}
<!-- -->
{% block scripts %}
<script nonce="{{ request.csp_nonce }}">
  window.addEventListener("load", function() {
    const feedback = () => {
      return user_feedback.h(user_feedback.App, {
        acceptText: "{% trans 'Send' %}",
        cancelText: "{% trans 'Cancel' %}",
        charCountText: "{% trans 'characters remaining' %}",
        description: "{% trans 'Leave feedback or get help' %}",
        feedbackTypes: [
          { value: 1, text: "Bug report" },
          { value: 2, text: "Feature request" },
          { value: 3, text: "General feedback" }
        ],
        menuFeedbackText: "{% trans 'Give Feedback' %}",
        menuHelpText: "{% trans 'Tutorials and Forums' %}",
        menuHelpUrl: "#",
        placeholder: "{% trans 'Let us know what is on your mind...' %}",
        snackbarError:
          "{% trans 'An error occurred.  Please try again later.' %}",
        snackbarSuccess: "{% trans 'Thanks for your feedback!' %}",
        text: "",
        title: "{% trans 'How can we improve your experience?' %}",
        url: "{% url 'user_feedback:post' %}"
      });
    };
    user_feedback.render(
      feedback(),
      document.getElementById("user-feedback-app")
    );
  });
</script>

<script nonce="{{request.csp_nonce}}">

  const iconpath = "{% static 'course_flow/img/images_svg/' %}";
  const detail_path = {
      project:"{% url 'course_flow:project-detail-view' pk='0'%}",
      activity:"{% url 'course_flow:workflow-detail-view' pk='0'%}",
      course:"{% url 'course_flow:workflow-detail-view' pk='0'%}"
  };
  const update_path = {
      project:"{% url 'course_flow:project-update' pk='0'%}",
      activity:"{% url 'course_flow:workflow-update' pk='0'%}",
      course:"{% url 'course_flow:workflow-update' pk='0'%}"
  };
  const create_path = {
      project:"{% url 'course_flow:project-create' %}",
      activity:"{% url 'course_flow:activity-strategy-create' %}",
      course:"{% url 'course_flow:course-strategy-create' %}"
  };

  const user_id = {{ user.id }};
  const read_only=false;
  window.addEventListener("load",function(){
      workflow_redux.renderHomeMenu(data_package);
  });

  fileLoader = document.createElement('input');
  fileLoader.type="file";
  fileLoader.accept=".json";
  fileLoader.addEventListener('change',()=>{
      let loader = new workflow_redux.Loader('body');
      let reader = new FileReader();
      reader.readAsText(fileLoader.files[0]);
      reader.onload = (evt)=>{
          let readData = evt.target.result;
          console.log(readData);
          $.post("{% url 'course_flow:project-from-json' %}", {
              jsonData:readData
          }).done(function(data){
              loader.endLoad();
              if(data.action == "posted") window.location.href="{% url 'course_flow:home' %}";
              else console.log("Failed");
          });
      }
  });

  $("#import-json").on("click",()=>{
      fileLoader.click();
  });
</script>

{% endblock %}
